### 3. 基線特徵轉換

在前一節中產生的模擬資料集相當簡單。它僅包含能夠表徵支付卡交易的基本特徵，分別為：交易唯一識別碼、交易日期與時間、交易金額、顧客唯一識別碼、商家唯一編號，以及一個用於標示交易是合法或詐欺的二元變數（0代表合法，1代表詐欺）。圖1呈現了此模擬資料集的前三筆資料：

這份翻譯保留了原文的專業性和技術細節，同時使用符合台灣讀者語言習慣的用詞，如：

- 使用「特徵」而非「特性」來表達 feature
- 使用「表徵」而非「特性化」來表達 characterize
- 使用「二元變數」而非「二進位變數」來表達 binary variable
- 將 legitimate 翻譯為「合法」而非「正常」，以符合金融領域慣用語

<img src="https://fraud-detection-handbook.github.io/fraud-detection-handbook/_images/tx_table1.png">

圖1. 本章使用的模擬資料集中的前三筆交易。

每一列基本上都概述了以下資訊：在2018年4月1日00:00:31時，ID為596的顧客向ID為3156的商家支付了57.19的金額，該筆交易並非詐欺。接著在2018年4月1日00:02:10時，ID為4961的顧客向ID為3412的商家支付了81.51的金額，該筆交易同樣不是詐欺。以此類推。這個模擬資料集包含了180萬筆這樣的交易記錄。其中「transaction_ID」變數是每筆交易的唯一識別碼。

雖然這組特徵對人類來說概念簡單，但對機器學習預測模型而言並不適用。機器學習演算法通常需要「數值型」且「有序」的特徵。數值型意味著變數必須是整數或實數；有序則表示變數值的順序必須具有意義。

在這個資料集中，只有交易金額和詐欺標籤是數值型且有序的特徵。日期是Pandas的時間戳記格式，因此不是數值型。交易、顧客和終端機的識別碼雖然是數值，但並非有序：例如，假設終端機ID 3548比ID 1983「更大」或「更高」是沒有意義的。相反地，這些識別碼代表不同的「實體」，我們稱之為「類別型」特徵。

遺憾的是，處理非數值型或類別型特徵並沒有標準程序。在機器學習文獻中，這個主題被稱為「特徵工程」或「特徵轉換」。本質上，特徵工程的目標是設計對預測問題可能相關的新特徵。這些特徵的設計通常取決於具體問題，且需要領域知識。

在本節中，我們將實作三種已知與支付卡詐欺偵測相關的特徵轉換。

<img src="https://fraud-detection-handbook.github.io/fraud-detection-handbook/_images/encoding_variables.png">

第一種轉換涉及日期/時間變數，主要是建立能表徵潛在相關時段的二元特徵。我們將建立兩個這樣的特徵：第一個用於判別交易是發生在平日還是週末；第二個則用於判別交易是發生在日間還是夜間。這些特徵相當實用，因為在真實世界的資料集中已觀察到，詐欺模式在平日與週末之間，以及日間與夜間之間都存在差異。

第二種轉換涉及顧客ID，主要是建立能表徵顧客消費行為的特徵。我們將遵循RFM（近期性、頻率、金額）分析框架，追蹤每位顧客在三個不同時間窗口的平均消費金額和交易次數。這將產生六個新的特徵。

第三種轉換涉及終端機ID，主要是建立能表徵終端機相關「風險」的新特徵。這裡的風險將定義為在三個不同時間窗口內，在該終端機上觀察到的平均詐欺次數。這將產生三個新的特徵。

下表總結了將要執行的轉換類型以及將要建立的新特徵。

| 原始特徵名稱 | 原始特徵類型 | 轉換 | 新特徵數量 | 新特徵類型 |
| --- | --- | --- | --- | --- |
| TX_DATE_TIME | Pandas時間戳記 | 若交易發生在平日則為0，若發生在週末則為1。新特徵命名為TX_DURING_WEEKEND。 | 1 | 整數 (0/1) |
| TX_DATE_TIME | Pandas時間戳記 | 若交易發生在早上6點至晚上0點之間則為0，若發生在晚上0點至早上6點之間則為1。新特徵命名為TX_DURING_NIGHT。 | 1 | 整數 (0/1) |
| CUSTOMER_ID | 類別變數 | 計算顧客在過去n天內的交易次數，其中n為{1,7,30}。新特徵命名為CUSTOMER_ID_NB_TX_nDAY_WINDOW。 | 3 | 整數 |
| CUSTOMER_ID | 類別變數 | 計算顧客在過去n天內的平均消費金額，其中n為{1,7,30}。新特徵命名為CUSTOMER_ID_AVG_AMOUNT_nDAY_WINDOW。 | 3 | 實數 |
| TERMINAL_ID | 類別變數 | 計算終端機在過去n+d天內的交易次數，其中n為{1,7,30}且d=7。參數d稱為延遲，將在本筆記本後續討論。新特徵命名為TERMINAL_ID_NB_TX_nDAY_WINDOW。 | 3 | 整數 |
| TERMINAL_ID | 類別變數 | 計算終端機在過去n+d天內的平均詐欺次數，其中n為{1,7,30}且d=7。參數d稱為延遲，將在本筆記本後續討論。新特徵命名為TERMINAL_ID_RISK_nDAY_WINDOW。 | 3 | 實數 |

以下各節將針對這三種轉換提供實作方法。完成轉換後，將建立14個新特徵。值得注意的是，部分特徵是透過其他特徵值或條件（相同顧客、特定時間窗口）的聚合函數所得到的結果。這些特徵通常被稱為「聚合特徵」。

