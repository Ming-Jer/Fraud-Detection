### 信用卡欺詐檢測的機器學習 Machine learning for credit card fraud detection

信用卡欺詐檢測 (CCFD) 就像大海撈針，它需要從數百萬的日常交易中找出哪些是欺詐性的。由於資料量不斷增加，人類專家現在幾乎不可能從交易資料中檢測出有意義的模式。出於這個原因，機器學習技術的使用，現在廣泛用於欺詐檢測領域，其中需要從大型資料集中提取信息[Car18, DP15, LJ20, PP19]。

機器學習 (ML) 是研究通過經驗自動改進的算法  [Bon21, FHT01].。 ML 與統計、模式識別和數據挖掘等領域密切相關。同時，它作為計算機科學和人工智能的一個子領域出現，並特別關注知識提取過程的算法部分。 ML 在許多科學學科中發揮著關鍵作用，它的應用是我們日常生活的一部分。例如，它用於過濾垃圾郵件、天氣預報、醫療診斷、產品推薦、人臉檢測、欺詐檢測等 [Bis06, DP15]。

ML 技術有效應對 CCFD 提出的挑戰的能力導致了過去十年中大量且不斷增長的研究。如圖 1 所示，在 2010 年至 2020 年間，已有數千篇與該主題相關的論文發表，僅 2020 年就發表了約 1500 篇論文。

![alt text](https://fraud-detection-handbook.github.io/fraud-detection-handbook/_images/ML_CCFD_GoogleScholar_2010_2020.png)
<p style="text-align: center;">
圖 1. 2010 年至 2020 年間機器學習和信用卡欺詐檢測主題的發表文章數量。來源：谷歌學術。
</p>

本節旨在通過總結主要研究挑戰以及可用於解決這些挑戰的關鍵機器學習概念，對近期研究進行概述。

## 最近的調查 Recent surveys

為了解 CCFD 機器學習研究的現狀，我們在 Google Scholar 上搜索了過去五年中關於該主題的所有評論和調查。 使用以下布爾搜索：（“機器學習”或“資料探勘”）和“信用卡”和“欺詐檢測”和（評論或調查）`("machine learning" OR "data mining") AND "credit card" AND "fraud detection" AND (review OR survey)`  並限制從 2015 年到 2021 年的搜索期，我們確定了十個評論/調查，其中 我們在下表中報告。

| 標題 | 日期 | 參考文獻 |
|---|---|---|
|信用卡欺詐檢測技術調查：數據和技術導向的觀點 | 2016 | {cite}`zojaji2016survey`|
|基於機器學習和自然啟發的信用卡欺詐檢測技術調查 | 2017 | {cite}`adewumi2017survey`|
|使用機器學習進行信用卡欺詐檢測調查 | 2018 | {cite}`popat2018survey`|
|機器學習技術在欺詐檢測研究中的最新進展回顧 | 2018 | {cite}`sinayobye2018state`|
|信用卡欺詐檢測：技術現狀 | 2018 | {cite}`sadgali2018detection`|
|信用卡欺詐檢測中不同數據挖掘與機器學習方法的調查 | 2018 | {cite}`patil2018survey`|
|信用卡欺詐檢測的資料探勘方法系統性回顧 | 2018 | {cite}`mekterovic2018systematic`|
|信用卡欺詐檢測的機器學習技術與用戶驗證方法綜合調查 | 2019 | {cite}`yousefi2019comprehensive`|
|信用卡欺詐檢測：系統性回顧 | 2019 | {cite}`priscilla2019credit`|
|使用機器學習進行信用卡欺詐檢測

五年內的一組十次調查可以被認為是高的。 在如此短的時間內發布瞭如此多的調查（尤其是 2018 年發布的五項調查）這一事實反映了 CCFD 的 ML 主題的快速發展以及獨立研究人員團隊在綜合研究狀態方面的需求 在這個領域裡。

鑑於這些調查的共同目標，值得注意的是，在內容方面可以發現高度的冗餘。 特別是，它們都強調了一組共同的方法和挑戰，我們將在接下來的兩節中介紹。 我們首先介紹基線方法，即在處理使用 ML 技術解決 CCFD 的論文中通常遵循的通用工作流程。 然後，我們總結了該主題所面臨的挑戰。

## 基線方法 - 監督學習 Baseline methodology - Supervised learning

大量的機器學習技術可用於解決 CCFD 的問題。 這直接反映在過去十年中發表的大量有關該主題的論文中。 儘管有大量的研究工作，但大多數提出的方法都遵循通用的基線 ML 方法 [Bis06, FHT01, PL18]，我們在圖 2 中對其進行了總結。

![alt text](https://fraud-detection-handbook.github.io/fraud-detection-handbook/_images/baseline_ML_workflow.png)
<p style="text-align: center;">
圖 2. CCFD 的 ML：基線方法，以及最近關於該主題的調查中提出的大多數方法。  
</p>

在信用卡欺詐檢測中，數據通常由交易資料組成，例如由支付處理器或銀行收集。交易資料可分為三組[AA17、LJ20、VVBC+15]

- 帳戶相關功能：包括賬號、開戶日期、卡額度、卡到期日等。
- 交易相關特徵：例如交易參考號、賬號、交易金額、終端（即POS）號碼、交易時間等。從終端上，還可以獲得額外的信息類別：與商家相關的特徵，例如其類別代碼（餐廳、超市……）或其位置。
- 與客戶相關的特徵：它們包括例如客戶編號、客戶類型（低調、高調……）等。

在最簡單的形式中，支付卡交易包括客戶在特定時間支付給商家的任何金額。一組歷史交易資料可以表示為如圖 3 所示的表格。對於欺詐檢測，通常還假設所有交易的合法性都是已知的（即交易是真實的還是欺詐的）。這通常由二進制標籤表示，真實交易的值為 0，欺詐交易的值為 1。

![alt text](https://fraud-detection-handbook.github.io/fraud-detection-handbook/_images/tx_table.png)
<p style="text-align: center;">
圖 3. 交易資料表格範例。每一列代表從客戶到終端機的一筆交易。最後一個變數是標籤，表示該筆交易是合法（0）或詐騙（1）。 
</p>

在基於機器學習的欺詐檢測系統的設計中可以區分兩個階段。第一階段包括從一組標記的歷史資料構建預測模型（圖 2，上部）。這個過程稱為監督學習，因為交易的標籤（真實或欺詐）是已知的。在第二階段，從監督學習過程中獲得的預測模型用於預測新交易的標籤（圖 2，下半部分）。

形式上，預測模型是帶有參數的參數函數θ，也稱為假設，它從輸入域X⊂Rn 中獲取輸入x ，並輸出預測 y^=h(x,θ)在輸出域Y⊂R [Car18, DP15] 上：
$$
h(x,\theta): \mathcal{X} \rightarrow \mathcal{Y}
$$

輸入域 X 通常不同於原始交易數據的空間，原因有兩個。首先，出於數學原因，大多數監督學習算法都要求輸入域是實值的，即  X⊂Rn，這需要轉換非實數的事務特徵（如時間戳、分類變量等）。其次，使用其他可能提高預測模型檢測性能的變量來豐富交易數據通常是有益的。此過程稱為特徵工程（也稱為特徵轉換、特徵提取或數據預處理）。

對於欺詐檢測，輸出域 Y 通常是給定輸入 x的預測類別，即Y={0,1}。鑑於輸出類是二元的，這些預測模型也稱為二元分類器。或者，輸出也可以用 Y=[0,1]表示為欺詐概率，或更一般地表示為風險評分，用 Y=R表示，其中較高的值表示較高的欺詐風險。

預測模型的訓練（或構建）包括找到提供最佳性能的參數。使用損失函數評估預測模型的性能，該損失函數將真實標籤與預測標籤進行比較對於輸入。在二元分類問題中，常見的損失函數是零/一損失函數，它在錯誤預測的情況下分配等於 1 的損失，否則分配為零：

$$
\begin{align}
L_{0/1}: \mathcal{Y} \times \mathcal{Y} &\rightarrow& \{0,1\} \\
y,\hat{y} &= & 
\begin{cases}
    1,& \text{if } y \ne \hat{y}\\
    0,& \text{if } y=\hat{y}
\end{cases}
\end{align}
$$


> [!NOTE]
> 零一損失函數是二元分類問題的標準損失函數。然而，由於信用卡詐騙偵測問題存在嚴重的類別不平衡（合法交易遠多於詐騙交易），因此這種函數並不適用。詐騙偵測系統效能的評估是一個複雜的議題，這將在[第四章]（效能指標）中深入探討。


為了公平評估預測模型的效能，一個重要的方法學實踐稱為「驗證」，是在未用於訓練的資料上評估預測模型的效能。這是通過在訓練之前將資料集分割為「訓練集」和「驗證集」來實現的。訓練集用於預測模型的訓練（也就是找到使訓練集損失最小化的參數 $\theta$）。一旦參數 $\theta$ 確定後，就使用驗證集來估計損失，這能更好地評估預測模型在未來（未見過的）交易上的預期效能。


> [!NOTE]
> 在實務上，由於信用卡交易的連續性質以及詐騙通報的延遲，在將資料集分割為訓練集和驗證集時必須特別謹慎。這些議題將在第五章中詳細說明。


監督式學習程序通常包含訓練一組預測模型並使用驗證集來估計其效能。在程序結束時，會選擇被認為能提供最佳效能（即在驗證集上有最低損失）的模型，並用於對新交易進行預測（見圖2）。

設計和訓練預測模型的方法有很多種。這部分解釋了為何在信用卡詐欺偵測的機器學習研究文獻如此豐富，其中論文通常著重於一種或幾種預測方法。Priscilla等人在2019年的調查研究為信用卡詐欺偵測問題中曾被考慮過的機器學習方法提供了很好的概述。他們的調查涵蓋了近百篇研究論文，確認了每篇論文使用的機器學習技術，詳見圖4。

![alt text](https://fraud-detection-handbook.github.io/fraud-detection-handbook/_images/ReviewMLforCCFD_2019_Table.png)
<p style="text-align: center;">
圖 4. 信用卡詐欺偵測中機器學習技術的使用頻率。來源：Priscilla 等人 
</p>

將學習技術分類為「高階」類別並非一件簡單的事，因為這些技術之間經常存在方法論、演算法或歷史上的關聯。Priscilla等人選擇將方法分為四個群組：監督式學習、非監督式學習、整體學習和深度學習。有人可能會認為，整體學習和深度學習應該屬於監督式學習的一部分，因為它們都需要已知的標籤。此外，深度學習和神經網路可以被視為同一類別。

涵蓋所有機器學習技術並非本書的範疇。相反地，我們的目標是為信用卡詐欺偵測提供一個參考和可重現的框架。根據我們的研究工作，我們決定涵蓋五種方法：邏輯迴歸（LR）、決策樹（DT）、隨機森林（RF）、提升法和神經網路/深度學習（NN/DL）。選擇LR和DT是因為它們簡單且具可解釋性。選擇RF和提升法是因為它們目前被認為是效能方面的最新技術。選擇NN/DL方法是因為它們提供了有前景的研究。

(ML_For_CCFD_Challenges)=
## 挑戰概述 Overview of challenges

信用卡詐欺偵測的機器學習是一個眾所周知的難題。以下我們總結了在相關研究評論中常被強調的挑戰 {cite}lucas2020credit,priscilla2019credit,mekterovic2018systematic,adewumi2017survey,zojaji2016survey。

**類別不平衡**：交易資料中合法交易遠多於詐欺交易：在真實世界的資料集中，詐欺交易的百分比通常遠低於1%。從不平衡資料中學習是一項困難的任務，因為大多數學習演算法無法很好地處理類別之間的巨大差異。處理類別不平衡需要使用額外的學習策略，如取樣或損失加權，這是一個被稱為不平衡學習的課題。

**概念漂移**：交易和詐欺模式會隨時間改變。一方面，信用卡使用者的消費習慣在工作日、週末、假期期間都不同，而且總體上會隨時間演變。另一方面，詐騙者會在舊技術過時時採用新技術。這些交易和詐欺分布的時間相依變化被稱為概念漂移。概念漂移需要設計能夠應對統計分布時間變化的學習策略，這是一個被稱為線上學習的課題。在實務上，概念漂移問題會因延遲回饋而更加嚴重（參見{ref}Fraud_Detection_System章節）。

**近即時要求**：詐欺偵測系統必須能夠快速偵測詐欺交易。考慮到潛在的高交易量（每天數百萬筆交易），可能需要低至數十毫秒的分類時間。這個挑戰與詐欺偵測系統的平行化和可擴展性密切相關。


**類別特徵**：交易資料通常包含許多類別特徵，例如客戶ID、終端機、卡片類型等。機器學習演算法無法很好地處理類別特徵，必須將其轉換為數值特徵。轉換類別特徵的常見策略包括特徵聚合、基於圖的轉換，或深度學習方法如特徵嵌入。

**序列建模**：每個終端機和/或客戶都會產生具有獨特特性的序列資料流。詐欺偵測的一個重要挑戰在於對這些資料流進行建模，以更好地描述其預期行為並偵測異常行為的發生。建模可以通過隨時間聚合特徵（例如，追蹤客戶的平均頻率或交易金額），或依靠序列預測模型（例如隱藏式馬可夫模型或遞迴神經網路）來完成。

**類別重疊**：最後兩個挑戰可以與兩個類別之間重疊的更一般性挑戰相關聯。僅憑交易的原始資訊，要區分詐欺交易和genuine交易幾乎是不可能的。這個問題通常通過特徵工程技術來解決，即在原始支付資訊中加入情境資訊。
  
**效能衡量**：由於類別不平衡問題和詐欺偵測的複雜成本結構，標準的分類系統衡量方式（如平均誤分類錯誤或AUC ROC）並不適合偵測問題。詐欺偵測系統應該能夠最大化詐欺交易的偵測，同時最小化錯誤預測的詐欺（假陽性）數量。通常需要考慮多個衡量指標來評估詐欺偵測系統的整體效能。儘管在詐欺偵測系統設計中扮演核心角色，目前仍未就應使用哪些效能衡量指標達成共識。
 
**缺乏公開資料集**：基於明顯的保密原因，真實世界的信用卡交易無法公開分享。目前只有一個公開分享的資料集，是我們團隊在2016年在Kaggle上發布的 {cite}Kaggle2016。儘管有其限制（只有兩天的資料，且特徵經過混淆），該資料集已在研究文獻中被廣泛使用，是Kaggle上最受歡迎和下載次數最多的資料集之一。詐欺偵測資料集的稀缺性在模擬資料方面也同樣存在：目前還沒有模擬器或參考模擬資料集。因此，大多數研究工作無法被重現，使得獨立研究者無法比較不同技術。

### 總結 Summary

信用卡詐欺偵測（CCFD）是一個具有挑戰性的問題，需要分析大量交易資料以識別詐欺模式。龐大的資料量加上詐騙者不斷演進的技術，使得人工調查員無法有效處理這個問題。在過去十年中，CCFD越來越多地輔以稱為機器學習（ML）的電腦演算法，這使得從大量資料中搜尋和偵測模式成為可能。ML演算法已被證實能顯著提高詐欺偵測系統的效率，並協助詐欺調查員偵測詐欺交易。

ML在CCFD領域已成為一個活躍的研究領域。這可從大量相關發表文獻及其充滿希望的研究成果中得到印證。同時，在解讀這些發表文獻的結果時也需要謹慎。如{ref}ML_For_CCFD所指出，ML在CCFD領域相對較新，目前還沒有公認的基準或方法論來比較和評估所提出的技術{cite}priscilla2019credit,mekterovic2018systematic,zojaji2016survey。

本書旨在朝這個方向邁出第一步，提出可重現的實作方案和基準方法論來處理ML在CCFD領域的議題。這些提出的實作方案和方法論是基於我們在該領域的經驗，來自我們與布魯塞爾大學機器學習組和Worldline支付處理公司長達十年的合作。
