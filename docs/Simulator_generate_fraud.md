### 詐欺情境生成

這是模擬的最後一個步驟，將根據以下詐欺情境在資料集中加入詐欺交易：

- 情境一：任何交易金額超過220的交易都視為詐欺。這個情境並非源自真實世界，而是提供一個明顯的詐欺模式，任何基礎詐欺偵測器都應該能夠察覺。這對於驗證詐欺偵測技術的實作很有幫助。
- 情境二：每天隨機抽取兩個終端機，這些終端機在接下來28天內的所有交易都會被標記為詐欺。這個情境模擬了終端機的犯罪使用情況，例如透過網路釣魚。透過追蹤終端機上詐欺交易次數的特徵，可以偵測出這種情境。由於終端機只在28天內遭到入侵，需要設計額外的概念漂移策略來有效處理此情境。
- 情境三：每天隨機抽取3位客戶。在接下來的14天內，這些客戶三分之一的交易金額會乘以5倍並標記為詐欺。這個情境模擬了一種「卡片未現」詐欺，其中客戶的憑證遭到外洩。客戶持續進行交易，而詐欺者則試圖透過較高金額的交易來最大化獲利。偵測這種情境需要加入追蹤客戶消費習慣的特徵。如同情境二，由於卡片只是暫時遭到入侵，也應該設計包含概念漂移的額外策略。

當交易資料模擬集現完成後，將所有交易加入詐欺標記。使用這些情境加入先前產生詐欺交易後，詐欺交易佔總交易的0.8%，總計14,681筆詐欺交易。值得注意的是，各情境的詐欺交易總和並不等於詐欺交易總數，這是因為同一筆交易可能被兩個或更多詐欺情境標記為詐欺。

其中情境一產生了973筆詐欺交易，情境二產生了9,077筆詐欺交易，情境三則產生了4,631筆詐欺交易。

接下來讓我們檢視每日的交易總數、詐欺交易數量，以及遭入侵卡片數量的變化情形。 這個模擬每天產生約10,000筆交易，其中每日詐欺交易約85筆，涉及的詐欺卡片約80張。值得注意的是，第一個月的詐欺交易數量較少，這是因為情境二和情境三的詐欺行為分別持續28天和14天所致。 這個結果資料集具有以下特點：類別不平衡（詐欺交易不到1%）、混合數值與類別特徵、特徵間存在非簡單的關聯性，以及具有時間相依性的詐欺情境。

最後，最後，讓我們將這個資料集儲存起來，以供本書後續使用。 我們不會儲存整個交易資料集，而是將其分割成每日批次。這樣做可以讓我們之後只需載入特定時期的資料，而不是整個資料集。為了加快載入速度，我們使用pickle格式而非CSV格式。所有檔案都會儲存在DIR_OUTPUT資料夾中，檔案名稱即為日期，副檔名為.pkl。

以下讓我們檢視執行過程：