### 擴展至更大規模的資料集

現在我們已經具備了生成更大規模資料集的所有基礎元件。讓我們編寫一個`generate_dataset`函式來執行所有先前的步驟。這個函式將：

- 接受所需的客戶數量、終端機數量、天數，以及起始日期和半徑`r`作為輸入參數
- 回傳生成的客戶檔案表格、終端機檔案表格，以及交易資料的DataFrame

'''{note}
為了加速運算，可以使用`pandarallel`模組中的`parallel_apply`函式。這個函式可以取代pandas的`apply`函式，並允許將運算分散到所有可用的CPU核心上。
'''

讓我們生成一個具有以下特性的資料集：

- 5,000位客戶
- 10,000個終端機
- 183天的交易資料（對應2024/04/01至2024/09/30的模擬期間）

起始日期固定在2024/04/01。半徑$r$設定為5，這表示每位客戶大約有100個可用的終端機。

在一般規格的筆記型電腦上，生成這個資料集約需3分鐘。最後總共生成了1,754,155筆交易資料。
基於Streamlit會於一載入程式碼會全部執行一次的特性，本範例內定不會直接執行，讓使用者確認要產生真實世界的資料後，才以圖形介面讓使用者開始執行。
並且可將資料儲存起來，提供其他案例使用。

相較於真實世界的詐欺偵測系統而言，這個數量其實相當少，因為實際系統每天可能需要處理數百萬筆交易。不過，就本書的目的而言，這樣的規模已經足夠，特別是為了保持合理的執行時間。

為了進行合理性檢查，我們將繪製交易金額和交易時間的分布圖。

<img src="https://fraud-detection-handbook.github.io/fraud-detection-handbook/_images/SimulatedDataset_42_0.png">

從圖中我們可以看出，交易金額的分布主要集中在小額交易；而交易時間的分布則呈現以正午為中心的每日高斯分布。這兩種分布都符合先前章節中使用的模擬參數設定。